# 2026-02-27 - Japan Dashboard Railway Deployment

## Problem
Japan travel dashboard wouldn't deploy properly on Railway. Multiple issues:

1. **"Not Found" error** - Railway detected project as Node.js (due to `package.json` in root) instead of Python
2. **Port issues** - Had hardcoded 8501 instead of using `$PORT` env var
3. **CSS not rendering** - `st.markdown(..., unsafe_allow_html=True)` sanitizes CSS styles

## Solution

### Railway Configuration (railway.json)
```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS"
  },
  "deploy": {
    "startCommand": "python -m streamlit run scripts/japan-dashboard.py --server.port $PORT --server.address 0.0.0.0 --server.headless true",
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### Key Fixes
- **Deleted `package.json`** from root - was causing Railway to detect as Node project
- **Use `$PORT`** env var, never hardcode
- **CSS injection** - Use `st.html("<style>...</style>")` instead of `st.markdown()`
- **Public URL** - No port in URL: `https://app-name.up.railway.app/`

### Working File Structure
```
requirements.txt  # Python deps only
railway.json      # Railway config
scripts/japan-dashboard.py  # Streamlit app
# NO package.json in root!
```

## Final Solution: Use Flask, Not Streamlit

**The real fix:** Abandoned Streamlit entirely. Used **Flask** instead:

```
app.py              # Flask app with routes
templates/index.html # Full HTML/CSS/JS (no sanitization!)
requirements.txt    # flask, gunicorn
railway.json        # gunicorn start command
```

**Why Flask works:**
- Serves raw HTML — no CSS sanitization, no iframe wrappers
- Full control over styling, animations, fonts
- Jinja2 templating for dynamic data
- Gunicorn for production serving

**When to use what:**
- **Streamlit** = data apps, charts, internal tools (quick but limited styling)
- **Flask** = custom designed dashboards, public-facing sites, full creative control

## Lessons
- Railway auto-detects project type by looking for certain files
- `st.markdown(unsafe_allow_html=True)` does NOT allow CSS through — Streamlit sanitizes heavily
- **Streamlit is the wrong tool for custom-designed UIs** — use Flask + Jinja2 templates instead
- Always test locally first before pushing
- Fresh Railway project is often cleaner than trying to fix broken config

## URLs
- Production: https://pierre-agent-platform-production.up.railway.app/
